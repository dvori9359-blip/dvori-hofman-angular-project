<div class="main-container">
  <header class="teams-header">
    <h1>My Teams</h1>
    <div class="create-team-box">
      <input type="text" placeholder="New team name..." #teamNameInput>
      <button (click)="createNewTeam(teamNameInput.value); teamNameInput.value=''">+ Create New Team</button>
    </div>
  </header>

  <hr>

  <div class="teams-grid">
    @for (team of teamsList(); track team.id) {
      <div class="team-card" (click)="onSelectTeam(team.id)">
        <button class="manage-team-btn" (click)="openManageTeamModal(team.id, $event)" title="Add Member">ğŸ‘¥</button>

        <div class="card-icon">ğŸ‘¥</div>
        <h3>{{ team.name }}</h3>
        
        <div class="members-badge">
          <span class="count-number">{{ team.members_count || team.members?.length || 0 }}</span>
          <span class="label">Members</span>
        </div>
        
        <button class="enter-btn">Enter Team</button>
      </div>
    }
    @empty {
      <p style="text-align:center; grid-column: 1/-1;">No teams found. Create one above!</p>
    }
  </div>

  @if (showTeamModal) {
    <div class="modal-overlay" (click)="showTeamModal = false">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h2>Manage Team Members</h2>
        
        <div class="add-member-row">
          <select [(ngModel)]="selectedUserIdToAdd">
            <option [value]="null">Select user...</option>
            @for (user of allUsersList(); track user.id) {
              <option [value]="user.id">{{ user.name }}</option>
            }
          </select>
          <button class="save-btn" (click)="addMemberToTeam()" [disabled]="!selectedUserIdToAdd">Add</button>
        </div>

        <div class="members-list-area">
          <h3>Current Members:</h3>
          <ul class="clean-list">
            @for (m of currentTeamMembers(); track m.id) {
              <li class="member-item-row">
                <span>ğŸ‘¤ {{ m.name }}</span>
                <button class="delete-member-btn" (click)="removeMember(m.id)" title="Remove Member">ğŸ—‘ï¸</button>
              </li>
            }
            @empty {
              <li>No members in this team yet.</li>
            }
          </ul>
        </div>
        <div class="modal-actions">
          <button class="cancel-btn" (click)="showTeamModal = false">Close</button>
        </div>
      </div>
    </div>
  }

  @if (alertMessage()) {
    <div class="modal-overlay alert-layer" (click)="alertMessage.set(null)">
      <div class="modal-content alert-box">
        <p>{{ alertMessage() }}</p>
        <button class="save-btn" (click)="alertMessage.set(null)">OK</button>
      </div>
    </div>
  }
</div>